<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Management Console</title>
    <meta http-equiv="refresh" content="5">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2, h3 { color: #333; }
        table { border-collapse: collapse; width: 80%; margin-bottom: 20px; }
        table, th, td { border: 1px solid #aaa; }
        th, td { padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { padding: 8px 16px; margin: 5px 0; cursor: pointer; }
        pre { background-color: #f7f7f7; padding: 10px; border: 1px solid #ddd; max-height: 300px; overflow-y: auto; }
    </style>
</head>

<body>
    <h1>Management Console</h1>

    <!-- Action Buttons -->
    <form action="/switch_version" method="post">
        <button type="submit">SWITCH VERSION</button>
    </form>
    <form action="/discard_old" method="post">
        <button type="submit">DISCARD OLD</button>
    </form>
    <form action="/reset_log" method="post">
        <button type="submit">RESET LOG</button>
    </form>
    <form action="/logout" method="get">
        <button type="submit">LOGOUT</button>
    </form>

    <!-- JWT Token -->
    <h2>API Token</h2>
    <pre id="jwt_token">Click below to get token</pre>
    <button onclick="fetchToken()">Get JWT Token</button>
    <script>
        async function fetchToken() {
            const res = await fetch('/get_token');
            const text = await res.text();
            document.getElementById('jwt_token').innerText = text;
        }
    </script>

    <!-- Log Viewer -->
    <h2>Log Viewer</h2>
    <pre>{{ logs }}</pre>

    <h2>Host CPU utilization</h2>
    <p>{{ host_cpu }} %</p>

    <!-- API Response Times -->
    <h2>API Response Times (ms)</h2>
    <table>
        <tr>
            <th>Endpoint</th>
            <th>Min</th>
            <th>Max</th>
            <th>Avg</th>
        </tr>
        <tr>
            <td>/status</td>
            <td>{{ status_stats.min }}</td>
            <td>{{ status_stats.max }}</td>
            <td>{{ status_stats.avg }}</td>
        </tr>
        <tr>
            <td>/log</td>
            <td>{{ log_stats.min }}</td>
            <td>{{ log_stats.max }}</td>
            <td>{{ log_stats.avg }}</td>
        </tr>
    </table>

    <!-- Container Monitoring -->
    <h2>Container Monitoring</h2>
    <table>
        <tr>
            <th>Container</th>
            <th>Uptime</th>
            <th>CPU %</th>
            <th>Memory Usage (MB)</th>
            <th>Memory Limit (MB)</th>
        </tr>
        {% for name, s in stats.items() %}
        <tr>
            <td>{{ name }}</td>
            {% if s.error %}
            <td colspan="4">{{ s.error }}</td>
            {% else %}
            <td>{{ s.uptime }}</td>
            <td>{{ s.cpu_percent }}</td>
            <td>{{ s.mem_usage }}</td>
            <td>{{ s.mem_limit }}</td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>

    <!-- Log Sizes -->
    <h2>Log Sizes</h2>
    <table>
        <tr>
            <th>Log File</th>
            <th>Size (bytes)</th>
        </tr>
        {% for fname, size in log_sizes.items() %}
        <tr>
            <td>{{ fname }}</td>
            <td>{{ size }}</td>
        </tr>
        {% endfor %}
    </table>
</body>

</html>
